name: create-pr

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
        with:
          fetch-depth: '0'
      - uses: actions/setup-ruby@v1
        with:
          ruby-version: '2.6' # Version range or exact version of a Ruby version to use, using semvers version range syntax.


      - name: create tag
        uses: anothrNick/github-tag-action@1.36.0
        id: create_tag
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          DEFAULT_BUMP: major
          RELEASE_BRANCHES: prod
          PRERELEASE_SUFFIX: rc
          WITH_V: true
          DRY_RUN: true

      - name: compile Pull Request
        id: compile_pr
#        run: ruby ./script/create-pr ${{ steps.create_tag.outputs.new_tag }}
        run: ruby ./script/create-pr

      - name: Create Pull Request
        uses: devops-infra/action-pull-request@v0.4.2
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          source_branch: edge
          target_branch: next
          title: ${{ steps.create_tag.outputs.new_tag }} | Release [Next]
#          template: .github/PULL_REQUEST_TEMPLATE.md
          body: ${{ steps.compile_pr.output }}
#          reviewer: octocat
#          assignee: octocat
#          label: enhancement
#          milestone: My milestone
#          draft: true
#          old_string: "<!-- Add your description here -->"
#          new_string: "** Automatic pull request**"
          get_diff: true
          ignore_users: "dependabot"