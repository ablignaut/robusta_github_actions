name: create-pr

on:
  workflow_dispatch:

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - uses: actions/setup-ruby@v1
        with:
          ruby-version: '2.6' # Version range or exact version of a Ruby version to use, using semvers version range syntax.


      - name: create tag
        uses: anothrNick/github-tag-action@1.36.0
        id: create_tag
        env:
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          DEFAULT_BUMP: major
          RELEASE_BRANCHES: prod
          PRERELEASE_SUFFIX: rc
          WITH_V: true
          DRY_RUN: true

      - name: compile Pull Request
        id: compile_pr
#        run: ruby ./script/create-pr ${{ steps.create_tag.outputs.new_tag }}
        run: ruby ./script/create-pr


      - name: Create Pull Request
        uses: peter-evans/create-pull-request@v3
        with:
          branch: edge
          base: next
##          token: ${{ secrets.PAT }}
#          commit-message: ${{ steps.create_tag.outputs.new_tag }} | Release [Next]
#          committer: GitHub <noreply@github.com>
#          author: ${{ github.actor }} <${{ github.actor }} @users.noreply.github.com>
#          signoff: false
#          branch: ${{ inputs.branch }}
#          delete-branch: false
          title:  ${{ steps.create_tag.outputs.new_tag }} | Release [Next]
          body: |
            ${{ steps.compile_pr.output }}
#
#          labels: |
#            automated pr
##          assignees: peter-evans
##          reviewers: peter-evans
##          team-reviewers: |
##            owners
##            maintainers
##          milestone: 1
##          draft: false
